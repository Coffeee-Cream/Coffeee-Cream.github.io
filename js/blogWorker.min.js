import"https://unpkg.com/comlink/dist/umd/comlink.js";import http from"https://unpkg.com/isomorphic-git@beta/http/web/index.js";import"https://unpkg.com/isomorphic-git";import"https://unpkg.com/@isomorphic-git/lightning-fs";import"https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.1.0/markdown-it.min.js";const dir="/";var fs=new LightningFS("fs"),pfs=fs.promises,md=markdownit({html:!0,breaks:!0,linkify:!0,typographer:!0}),blogList=[];const getBlogs=async function(t,e,n){try{await pfs.readFile("/README.md",{encoding:"utf8"}),await pfs.readFile("/registry/scratch-projects.json",{encoding:"utf8"}),await pfs.readFile("/blogs/blogs.json",{encoding:"utf8"})}catch{await git.clone({fs:fs,http:http,dir:"/",corsProxy:"https://cors.isomorphic-git.org",url:"https://github.com/Coffeee-Cream/blog",ref:"main",singleBranch:!0,depth:10})}console.log("geting...");let o=await pfs.readFile("/README.md",{encoding:"utf8"});run(`document.querySelector("#blog > .vertical-center").innerHTML = \`<section>${md.render(o)}<br><div class="scroll">scroll â–¼ down</div></section>\``),0==navigator.onLine&&run('document.querySelector("#blog-list > .vertical-center").innerHTML = "Your Offline"');let s=await pfs.readFile("/registry/scratch-projects.json",{encoding:"utf8"});s=JSON.parse(s),s=s.data,run('document.querySelector("#scratch-proj > .vertical-center").style.display = "none"');for(let t=0;t<s.length;t++)run(t>5?'let doc = document.createElement("div")\n\t\t\tdoc.innerHTML = `<br>\n\t\t\t<span style="text-align: center">\n\t\t\t<a href="https://scratch.mit.edu/users/CoffeeeCream/projects/" target="_blank">More...</a>\n\t\t\t</span>\n\t\t\t`\n\t\t\tdocument.getElementById("proj-holder").append(doc)':`let doc = document.createElement("div")\n\t\t\tdoc.innerHTML = \`<img src="https://cdn2.scratch.mit.edu/get_image/project/${s[t].id}_144x108.png" width="90%"  loading="lazy">\n\t\t\t<br>\n\t\t\t<span style="text-align: center">\n\t\t\t<a href="https://scratch.mit.edu/projects/${s[t].id}" target="_blank">${s[t].name}</a>\n\t\t\t</span>\n\t\t\t\`\n\t\t\tdocument.getElementById("proj-holder").append(doc)`);blogList=await pfs.readFile("/blogs/blogs.json",{encoding:"utf8"}),blogList=JSON.parse(blogList),run('document.querySelector("#blog-list").innerHTML = ""');for(let t=0;t<blogList.length;t++)run(`\n\t\tlet tags = '${JSON.stringify({d:blogList[t].tags})}'\n\t\ttags = JSON.parse(tags);tags = tags.d\n\t\tlet classes = ""\n\t\tfor(let i=0;i<tags.length;i++) {\n\t\t\tlet tag = document.createElement('span')\n\t\t\ttag.innerHTML = "#"+tags[i]+" "\n\t\t\ttag.classList += tags[i]\n\t\t\tclasses += tag.outerHTML+" "\n\t\t}\n\t\tlet doc = document.createElement("span")\n\t\tdoc.innerHTML = \`\n\t\t<a href="/?blog=${blogList[t].name}#read-blog">${blogList[t].name}</a><br><span class="desc">${blogList[t].description.slice(0,67)+"..."}</span><br>\${classes}\n\t\t\`\n\t\tdocument.querySelector("#blog-list").append(doc)\n\n\t\tdoc = document.createElement("br")\n\t\tdocument.querySelector("#blog-list").append(doc)`);if(t>-1){const t=new URLSearchParams(e).get("blog");if("repeat"==await readBlogs(t)){"repeat"==await readBlogs(t)&&postMessage('document.querySelector("#read-blog > .vertical-center").style.display = "none"\n\t\t\tdocument.getElementById("reader").innerHTML = `<h1>Hmm, where is the blog?</h1>\n<p>Looks like the blog you are trying to accses is not avalible at the moment or does not exist.<br><br><a href="#blog">Go to blog page</a></p>`\n\t\t\tdocument.getElementById("reader").style.display = "block"')}}await git.clone({fs:fs,http:http,dir:"/",corsProxy:"https://cors.isomorphic-git.org",url:"https://github.com/Coffeee-Cream/blog",ref:"main",singleBranch:!0,depth:10})},readBlogs=async function(t){for(let e=0;e<blogList.length;e++){if(t==blogList[e].name)return void postMessage(`\n\t\t\tlet tags = '${JSON.stringify({d:blogList[e].tags})}'\n\t\t\ttags = JSON.parse(tags);tags = tags.d\n\t\t\tlet classes = ""\n\t\t\tfor(let i=0;i<tags.length;i++) {\n\t\t\t\tlet tag = document.createElement('span')\n\t\t\t\ttag.innerHTML = "#"+tags[i]+" "\n\t\t\t\ttag.classList += tags[i]\n\t\t\t\tclasses += tag.outerHTML+" "\n\t\t\t}\n\t\t\tdocument.querySelector("#read-blog > .vertical-center").style.display = "none"\n\t\t\tdocument.getElementById("reader").innerHTML = \`${md.render(await pfs.readFile("/blogs/markup/"+blogList[e].file.location,{encoding:"utf8"}))}\`\n\t\t\tdocument.getElementById("reader").style.display = "block"\n\t\t\tlet t = document.createElement('div')\n\t\t\tt.innerHTML = "<br><br><br>"+classes\n\t\t\tdocument.getElementById("reader-edge").append(t)\n\t\t\tdocument.getElementById("reader-edge").style.display = "block"\n\t\t\t`);if(e>=blogList.length-1)return await git.clone({fs:fs,http:http,dir:"/",corsProxy:"https://cors.isomorphic-git.org",url:"https://github.com/Coffeee-Cream/blog",ref:"main",singleBranch:!0,depth:10}),"repeat"}};function run(t){postMessage(t)}Comlink.expose(getBlogs);
