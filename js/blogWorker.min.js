import"https://unpkg.com/comlink/dist/umd/comlink.js";import http from"https://unpkg.com/isomorphic-git@beta/http/web/index.js";import"https://unpkg.com/isomorphic-git";import"https://unpkg.com/@isomorphic-git/lightning-fs";import"https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.1.0/markdown-it.min.js";const dir="/";var fs=new LightningFS("fs"),pfs=fs.promises,md=markdownit({html:!0,breaks:!0,linkify:!0,typographer:!0}),blogList=[];const getBlogs=async function(t,e){try{await pfs.readFile("/README.md",{encoding:"utf8"}),await pfs.readFile("/registry/scratch-projects.json",{encoding:"utf8"}),await pfs.readFile("/blogs/blogs.json",{encoding:"utf8"})}catch{await git.clone({fs:fs,http:http,dir:"/",corsProxy:"https://cors.isomorphic-git.org",url:"https://github.com/Coffeee-Cream/blog",ref:"main",singleBranch:!0,depth:10})}console.log("geting...");let n=await pfs.readFile("/README.md",{encoding:"utf8"});run(`document.querySelector("#blog > .vertical-center").innerHTML = \`<section>${md.render(n)}<br><div class="scroll">scroll â–¼ down</div></section>\``),0==navigator.onLine&&run('document.querySelector("#blog-list > .vertical-center").innerHTML = "Your Offline"');let o=await pfs.readFile("/registry/scratch-projects.json",{encoding:"utf8"});o=JSON.parse(o),o=o.data,run('document.querySelector("#scratch-proj > .vertical-center").style.display = "none"');for(let t=0;t<o.length;t++)run(t>5?'let doc = document.createElement("div")\n\t\t\tdoc.innerHTML = `<br>\n\t\t\t<span style="text-align: center">\n\t\t\t<a href="https://scratch.mit.edu/users/CoffeeeCream/projects/" target="_blank">More...</a>\n\t\t\t</span>\n\t\t\t`\n\t\t\tdocument.getElementById("proj-holder").append(doc)':`let doc = document.createElement("div")\n\t\t\tdoc.innerHTML = \`<img src="https://cdn2.scratch.mit.edu/get_image/project/${o[t].id}_144x108.png" width="90%"  loading="lazy">\n\t\t\t<br>\n\t\t\t<span style="text-align: center">\n\t\t\t<a href="https://scratch.mit.edu/projects/${o[t].id}" target="_blank">${o[t].name}</a>\n\t\t\t</span>\n\t\t\t\`\n\t\t\tdocument.getElementById("proj-holder").append(doc)`);blogList=await pfs.readFile("/blogs/blogs.json",{encoding:"utf8"}),blogList=JSON.parse(blogList),run('document.querySelector("#blog-list").innerHTML = ""');for(let t=0;t<blogList.length;t++){let e;for(let n=0;n<blogList[t].tags.length;n++)e+=`${blogList[t].tags[n]}`;run(`let doc = document.createElement("span")\n\t\tdoc.innerHTML = \`\n\t\t<a href="/?blog=${blogList[t].name}#read-blog">${blogList[t].name}</a>\n\t\t\`\n\t\tdocument.querySelector("#blog-list").append(doc)\n\n\t\tdoc = document.createElement("br")\n\t\tdocument.querySelector("#blog-list").append(doc)`)}if(t>-1){const t=new URLSearchParams(e).get("blog");if("repeat"==await readBlogs(t)){"repeat"==await readBlogs(t)&&postMessage('document.querySelector("#read-blog > .vertical-center").style.display = "none"\n\t\t\tdocument.getElementById("reader").innerHTML = `<h1>Hmm, where is the blog?</h1>\n<p>Looks like the blog you are trying to accses is not avalible at the moment or does not exist.<br><br><a href="#blog">Go to blog page</a></p>`\n\t\t\tdocument.getElementById("reader").style.display = "block"')}}},readBlogs=async function(t){for(let e=0;e<blogList.length;e++){if(t==blogList[e].name)return void postMessage(`document.querySelector("#read-blog > .vertical-center").style.display = "none"\n\t\t\tconsole.log("md")\n\t\t\tdocument.getElementById("reader").innerHTML = \`${md.render(await pfs.readFile("/blogs/markup/"+blogList[e].file.location,{encoding:"utf8"}))}\`\n\t\t\tdocument.getElementById("reader").style.display = "block"`);if(e>=blogList.length-1)return await git.clone({fs:fs,http:http,dir:"/",corsProxy:"https://cors.isomorphic-git.org",url:"https://github.com/Coffeee-Cream/blog",ref:"main",singleBranch:!0,depth:10}),"repeat"}};function run(t){postMessage(t)}Comlink.expose(getBlogs);
